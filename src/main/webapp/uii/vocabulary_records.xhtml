<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        template="/uii/templatePG/templatePG.html"
        xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG"
>

    <ui:param
            name="myPageTitle"
            value="#{msgs.vocabularyManager_vocabulary}: #{vocabularyBeanLEGACY.currentVocabularyLEGACY.title}"/>

    <ui:define name="breadcrumb">
        <intranda:breadcrumb
                id="index"
                label="#{DashboardForm.plugin==null?msgs.startseite:msgs.dashboard}"
                action="index"
                navId="a0"/>
        <intranda:breadcrumb
                id="admin"
                label="#{msgs.intranda_administration_vocabularies}"
                action="vocabulary_all"/>
        <intranda:breadcrumb
                id="edit"
                label="#{vocabularyBeanLEGACY.currentVocabularyLEGACY.title}"
                action="vocabulary_records"
                noSeparator="#{true}"/>
    </ui:define>

    <ui:define name="info">
    </ui:define>

    <ui:define name="content">
        <script
                type="text/javascript"
                src='template/js/plugins/tinymce/tinymce.min.js'></script>

        <h:form
                id="myform"
                styleClass="form-horizontal form-bordered"
                onkeypress="submitOnEnter(event);"
                rendered="#{LoginForm.hasRole('Admin_Vocabulary')}">

            <div class="row" role="main">
                <div class="col-12 col-lg-6 mb-4">
                    <intranda:vocabularyRecordList vocabulary="#{vocabularyRecordListBean.vocabulary}"/>
                </div>

                <!--                <div class="col-12 col-lg-6">-->
                <!--                    <intranda:box-->
                <!--                            boxType="action"-->
                <!--                            boxForm="true"-->
                <!--                            boxPadding="false"-->
                <!--                            title="#{vocabularyBeanLEGACY.currentVocabRecord.title eq '' ? vocabularyBeanLEGACY.currentVocabularyLEGACY.title : vocabularyBeanLEGACY.currentVocabRecord.title}"-->
                <!--                            icon="fa-file-o">-->

                <!--                        <intranda:formOutputText label="#{msgs.id}"-->
                <!--                                                 field="#{vocabularyBeanLEGACY.currentVocabRecord.id}"-->
                <!--                                                 name="recordid"/>-->

                <!--                        <ui:repeat var="field" value="#{vocabularyBeanLEGACY.currentVocabRecord.fields}">-->
                <!--                            <ui:fragment rendered="#{field.definition.type eq 'input'}">-->
                <!--                                <intranda:formInputText-->
                <!--                                        name="field1"-->
                <!--                                        field="#{field.value}"-->
                <!--                                        required="#{field.definition.required}"-->
                <!--                                        displayAsRequired="#{field.definition.required}"-->
                <!--                                        label="#{field.label} #{field.definition.language != '' ? msgs[field.displayLanguageKey] : ''}"-->
                <!--                                        validationMethod="#{vocabularyBeanLEGACY.validateFieldValue}"-->
                <!--                                        idForValidator="#{field.label}"/>-->
                <!--                            </ui:fragment>-->
                <!--                            <ui:fragment rendered="#{field.definition.type eq 'textarea'}">-->
                <!--                                <intranda:formInputTextArea-->
                <!--                                        name="field2"-->
                <!--                                        field="#{field.value}"-->
                <!--                                        required="#{field.definition.required}"-->
                <!--                                        displayAsRequired="#{field.definition.required}"-->
                <!--                                        label="#{field.label} #{field.definition.language != '' ? msgs[field.displayLanguageKey] : ''}"-->
                <!--                                        validationMethod="#{vocabularyBeanLEGACY.validateFieldValue}"-->
                <!--                                        idForValidator="#{field.label}"/>-->
                <!--                            </ui:fragment>-->
                <!--                            <ui:fragment rendered="#{field.definition.type eq 'select1'}">-->
                <!--                                <intranda:formInputDropDown-->
                <!--                                        name="field3"-->
                <!--                                        field="#{field.value}"-->
                <!--                                        selectItems="#{field.definition.selecteableValues}"-->
                <!--                                        required="#{field.definition.required}"-->
                <!--                                        displayAsRequired="#{field.definition.required}"-->
                <!--                                        label="#{field.label} #{field.definition.language != '' ? msgs[field.displayLanguageKey] : ''}"-->
                <!--                                        validationMethod="#{vocabularyBeanLEGACY.validateFieldValue}"-->
                <!--                                        idForValidator="#{field.label}"/>-->
                <!--                            </ui:fragment>-->
                <!--                            <ui:fragment rendered="#{field.definition.type eq 'select'}">-->
                <!--                                <intranda:formInputSelectMany-->
                <!--                                        name="field4"-->
                <!--                                        field="#{field.valueMultiSelect}"-->
                <!--                                        selectItems="#{field.definition.selectList}"-->
                <!--                                        required="#{field.definition.required}"-->
                <!--                                        displayAsRequired="#{field.definition.required}"-->
                <!--                                        label="#{field.label} #{field.definition.language != '' ? msgs[field.displayLanguageKey] : ''}"-->
                <!--                                        validationMethod="#{vocabularyBeanLEGACY.validateFieldValue}"-->
                <!--                                        idForValidator="#{field.label}"/>-->
                <!--                            </ui:fragment>-->
                <!--                            <ui:fragment rendered="#{field.definition.type eq 'html'}">-->
                <!--                                <intranda:formInputTextArea-->
                <!--                                        name="field5"-->
                <!--                                        field="#{field.value}"-->
                <!--                                        required="#{field.definition.required}"-->
                <!--                                        displayAsRequired="#{field.definition.required}"-->
                <!--                                        label="#{field.label} #{field.definition.language != '' ? msgs[field.displayLanguageKey] : ''}"-->
                <!--                                        validationMethod="#{vocabularyBeanLEGACY.validateFieldValue}"-->
                <!--                                        idForValidator="#{field.label}"/>-->
                <!--                            </ui:fragment>-->
                <!--                        </ui:repeat>-->

                <!--                        <div class="box__actions">-->

                <!--                            &lt;!&ndash; Delete &ndash;&gt;-->
                <!--                            <c:if test="#{vocabularyBeanLEGACY.currentVocabRecord.id != null}">-->
                <!--                                <a-->
                <!--                                        id="delete"-->
                <!--                                        href="#"-->
                <!--                                        class="btn btn-hot me-auto"-->
                <!--                                        data-bs-toggle="modal"-->
                <!--                                        data-bs-target="#deleteModal">-->
                <!--                                    <i class="fa fa-trash-o" title="#{msgs.vocabularyManager_deleteRecord}"/>-->
                <!--                                    <span>-->
                <!--                                        <h:outputText value="#{msgs.loeschen}"/>-->
                <!--                                      </span>-->
                <!--                                </a>-->

                <!--                                <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog"-->
                <!--                                     aria-labelledby="myModalLabel">-->
                <!--                                    <div class="modal-dialog" role="document">-->
                <!--                                        <div class="modal-content">-->
                <!--                                            <div class="modal-header bg-primary-400 text-white">-->
                <!--                                                <h4 class="modal-title" id="myModalLabel">-->
                <!--                                                    <h:outputText value="#{msgs.loeschen}"/>-->
                <!--                                                </h4>-->
                <!--                                            </div>-->
                <!--                                            <div class="modal-body">-->
                <!--                                                <p>#{msgs.sollDieserEintragWirklichGeloeschtWerden}</p>-->
                <!--                                            </div>-->
                <!--                                            <div class="modal-footer">-->
                <!--                                                <button type="button" class="btn btn-blank" data-bs-dismiss="modal"-->
                <!--                                                        aria-hidden="true">#{msgs.abbrechen}</button>-->
                <!--                                                <button jsf:id="confirmDelete" class="btn btn-hot"-->
                <!--                                                        jsf:action="#{vocabularyBeanLEGACY.deleteRecord}">-->
                <!--                                                    <span class="fa fa-trash-o"/>-->
                <!--                                                    <span>-->
                <!--                                                    <h:outputText value="#{msgs.vocabularyManager_deleteRecord}"/>-->
                <!--                                                  </span>-->
                <!--                                                </button>-->
                <!--                                            </div>-->
                <!--                                        </div>-->
                <!--                                    </div>-->
                <!--                                </div>-->
                <!--                            </c:if>-->

                <!--                            &lt;!&ndash; Save &ndash;&gt;-->
                <!--                            <f:event listener="#{vocabularyBeanLEGACY.resetValidationResults}" type="preRenderView"/>-->
                <!--                            <button-->
                <!--                                    class="btn btn-success submitOnEnter"-->
                <!--                                    jsf:id="absenden"-->
                <!--                                    type="submit"-->
                <!--                                    jsf:action="#{vocabularyBeanLEGACY.saveRecordEdition}">-->
                <!--                                <span class="fa fa-save"/>-->
                <!--                                <span>-->
                <!--                                      <h:outputText value="#{msgs.speichern}"/>-->
                <!--                                    </span>-->
                <!--                            </button>-->

                <!--                        </div>-->

                <!--                    </intranda:box>-->
                <!--                    &lt;!&ndash; // Right area for editing a record &ndash;&gt;-->
                <!--                </div> &lt;!&ndash; /col-12 &ndash;&gt;-->

            </div>

        </h:form>

    </ui:define>
    <script type="text/javascript">
        //<![CDATA[
        var simpleTinyMceConfig = {
            selector: '.editor',
            setup: function (editor) {
                editor.on('change', function () {
                    tinymce.triggerSave();
                });
            },
            valid_elements: 'p,strong,em,span[!style<text-decoration: underline;],sup,',
            statusbar: true,
            theme: 'modern',
            height: 250,
            plugins: ['print code preview fullscreen'],
            menu: {},
            toolbar: false,
            toolbar: 'undo redo | bold italic underline | superscript | code ',
            content_css: 'css/content.css',
            init_instance_callback: function (editor) {
                var readOnlyAttr = $("#" + editor.id.replace(":", "\\:")).attr("readonly");
                if (readOnlyAttr === "readonly") {
                    editor.setMode("readonly");
                }
            },
            setup: function (editor) {
                editor.on("blur", function (event, a, b) {
                    editor.save();
                    $("#" + editor.id.replace(":", "\\:")).trigger("change");
                });
            }

        };

        function initTinyMce() {
            console.log("Init tinyMce");
            tinymce.init(simpleTinyMceConfig);
        }

        $(window).on("load", function () {
            renderInputFields()
        })

        jsf.ajax.addOnEvent(function (data) {
            var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
            switch (ajaxstatus) {
                case "success": // This is called when ajax response is successfully processed.
                    renderInputFields()
                    break;
            }
        });

        function renderInputFields(ajaxData) {
            if (typeof tinyMCE !== 'undefined') {
                if (ajaxData === undefined || ajaxData.status == "begin") {
                    for (edId in tinyMCE.editors) {
                        try {
                            tinyMCE.editors[edId].remove();
                            console.log("Removed editor " + edId);
                        } catch (error) {
                            console.log("Error occured during removing editors; ", error);
                        }
                    }
                }
                if (ajaxData === undefined || ajaxData.status == "success") {
                    initTinyMce(ajaxData);
                }
            }
        }

        //]]>
    </script>
</ui:composition>
