<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        template="/uii/templatePG/templatePG.html"
        xmlns:composite="http://xmlns.jcp.org/jsf/composite"
        xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:jsf="http://xmlns.jcp.org/jsf"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:x="http://myfaces.apache.org/tomahawk"
>

    <composite:interface componentType="io.goobi.workflow.api.vocabulary.beans.VocabularyRecordEditorBean">
        <composite:attribute
                name="record"
                type="io.goobi.vocabulary.exchange.VocabularyRecord"
                required="true"
        />
        <composite:attribute
                name="showID"
                type="boolean"
                default="true"
                required="false"
        />
    </composite:interface>

    <composite:implementation>
        <f:event type="postAddToView" listener="#{cc.init}"/>
        <ui:fragment rendered="#{cc.attrs.showID}">
            <intranda:formOutputText label="#{msgs.id}"
                                     field="#{cc.attrs.record.id}"
                                     name="recordid"/>
        </ui:fragment>

        <ui:repeat var="field" value="#{cc.sortedExtendedFields}">

            <div class="row">
                <div class="col-12 col-md-3" tabindex="-1">
                    <intranda:formLabel label="#{field.definition.name}"/>

                </div>
                <div class="col-12 col-md-9 p-0">
                    <ui:repeat var="value" value="#{field.values}">
                        <ui:repeat var="translation" value="#{value.translations}">
                            <!-- Simple text type -->
                            <ui:fragment
                                    rendered="#{field.allSelectableItems.size() == 0 and field.type.large == false}">
                                <div class="#{translation.language != null ? 'row' : 'p-2'} col-12 border-0">
                                    <!-- LANGUAGE -->
                                    <div class="col-12 col-md-3" tabindex="-1"
                                         jsf:rendered="#{translation.language != null}">
                                        <intranda:formLabel
                                                label="#{translation.language != null ? translation.language : ''}"
                                                labelFor="field1"/>
                                    </div>
                                    <!-- // LANGUAGE -->
                                    <!-- CONTENT -->
                                    <div class="#{translation.language != null ? 'col-12 col-md-9' : ''}">
                                        <h:inputText
                                                id="field1"
                                                styleClass="form-control form__input"
                                                value="#{translation.value}"
                                                readonly="false"
                                                disabled="false"
                                        />
                                    </div>
                                    <!-- // CONTENT -->
                                </div>
                            </ui:fragment>
                            <!-- // Simple text type -->
                            <!-- Text area type -->
                            <ui:fragment
                                    rendered="#{field.allSelectableItems.size() == 0 and field.type.large == true}">
                                <div class="#{translation.language != null ? 'row' : 'p-2'}  col-12 border-0">
                                    <!-- LANGUAGE -->
                                    <div class="col-12 col-md-3" tabindex="-1"
                                         jsf:rendered="#{translation.language != null}">
                                        <intranda:formLabel
                                                label="#{translation.language != null ? translation.language : ''}"
                                                labelFor="field2"/>
                                    </div>
                                    <!-- // LANGUAGE -->
                                    <!-- CONTENT -->
                                    <div class="#{translation.language != null ? 'col-12 col-md-9' : ''}">
                                        <h:inputTextarea
                                                id="field2"
                                                styleClass="form-control metsEditorTextArea"
                                                value="#{translation.value}"
                                                rows="6"
                                        />
                                    </div>
                                    <!-- // CONTENT -->
                                </div>
                            </ui:fragment>
                            <!-- // Text area  type -->
                            <!-- Vocabulary record references are handled as simple selection types, the magic happens in the JSF vocabulary wrapper classes -->
                            <!-- Single select type -->
                            <ui:fragment
                                    rendered="#{field.allSelectableItems.size() > 0 and field.definition.multiValued == false}">
                                <div class="#{translation.language != null ? 'row' : 'p-2'}  col-12 border-0">
                                    <!-- LANGUAGE -->
                                    <div class="col-12 col-md-3" tabindex="-1"
                                         jsf:rendered="#{translation.language != null}">
                                        <intranda:formLabel
                                                label="#{translation.language != null ? translation.language : ''}"
                                                labelFor="field3"/>
                                    </div>
                                    <!-- // LANGUAGE -->
                                    <!-- CONTENT -->
                                    <div class="#{translation.language != null ? 'col-12 col-md-9' : ''}">
                                        <h:selectOneMenu
                                                id="field3"
                                                styleClass="form-control form__input"
                                                value="#{translation.value}">
                                            <f:selectItem
                                                    itemValue="null"
                                                    itemLabel="#{msgs.bitteAuswaehlen}"/>
                                            <f:selectItems
                                                    value="#{field.currentlySelectableItems}"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <!-- // CONTENT -->
                                </div>
                            </ui:fragment>
                            <!-- // Single select  type -->
                        </ui:repeat>
                        <ui:fragment rendered="#{field.values.size() > 1}">
                            <h:commandButton action="#{field.deleteFieldValue(value)}"
                                             value="Delete value">
                                <f:ajax render="@form" execute="@form"/>
                            </h:commandButton>
                        </ui:fragment>
                    </ui:repeat>
                    <!-- Multi select type -->
                    <ui:fragment
                            rendered="#{field.allSelectableItems.size() > 0 and field.definition.multiValued == true}">
                        <div class="#{translation.language != null ? 'row' : 'p-2'}  col-12 border-0">
                            <!-- LANGUAGE -->
                            <div class="col-12 col-md-3" tabindex="-1"
                                 jsf:rendered="#{translation.language != null}">
                                <intranda:formLabel
                                        label="#{translation.language != null ? translation.language : ''}"
                                        labelFor="field4"/>
                            </div>
                            <!-- // LANGUAGE -->
                            <!-- CONTENT -->
                            <h:panelGroup layout="block">
                                <h:selectOneMenu
                                        styleClass="form-select"
                                        id="field4"
                                        forceId="true"
                                        value="#{field.currentValue}"
                                        required="false">
                                    <f:ajax execute="@form" render="@form" event="change"/>
                                    <f:selectItem itemValue="" itemLabel="#{msgs.bitteAuswaehlen}"/>
                                    <f:selectItems value="#{field.currentlySelectableItems}"/>
                                </h:selectOneMenu>

                                <h:panelGroup id="multiselect-id">
                                    <x:dataList
                                            id="datalist-id"
                                            value="#{field.allSelectedValueKeys}"
                                            var="selection">
                                        <button class="badge badge-intranda-light mt-3"
                                                jsf:action="#{field.removeSelectedValue(selection)}"
                                                title="#{msgs.removeSelectedItem}" data-bs-toggle="tooltip">
                                            <span class="fa fa-trash fs-400"/>
                                            <span class="fs-400">
                                                    <h:outputText value="#{selection}"/>
                                                </span>
                                            <f:ajax execute="@form" render="@form"/>
                                        </button>
                                    </x:dataList>
                                </h:panelGroup>
                            </h:panelGroup>
                            <!-- // CONTENT -->
                        </div>
                    </ui:fragment>
                    <!-- // Multi select  type -->
                    <ui:fragment rendered="#{field.definition.multiValued == true}">
                        <h:commandButton action="#{field.addFieldValue()}" value="Add value">
                            <f:ajax render="@form" execute="@form"/>
                        </h:commandButton>
                    </ui:fragment>
                </div>
            </div>
        </ui:repeat>
    </composite:implementation>
</ui:composition>
